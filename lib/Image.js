'use strict';

var loaded = require('./imageLoaded.js');
var Listeners = require('./Listeners.js');

var Image = function Image(source) {
  this.width = 0;
  this.height = 0;

  this.hasLoaded = false;
  this.src = null;

  this.listeners = Listeners.create();

  if (!source) {
    return;
  }

  if (typeof source === 'string') {
    this.src = source;
    var img = document.createElement('img');
    img.src = this.src;
    source = img;
  } else {
    this.src = source.src;
  }

  this.source = source;

  loaded(source, function (err) {
    if (err) {
      this.notify('error', err);
    } else {
      this.hasLoaded = true;
      this.width = source.naturalWidth;
      this.height = source.naturalHeight;
      this.notify('load', this);
    }
  }.bind(this));
};

Image.create = function (source) {
  return new Image(source);
};

Image.prototype.getAspectRatio = function () {
  if (!this.hasLoaded) {
    return 1;
  }

  return this.width / this.height;
};

Image.prototype.notify = function (type, data) {
  var listeners = this.listeners;
  setTimeout(function () {
    listeners.notify(type, data);
  }, 0);
};

Image.prototype.on = function (type, fn) {
  this.listeners.on(type, fn);
  return this;
};

Image.prototype.off = function (type, fn) {
  this.listeners.off(type, fn);
  return this;
};

module.exports = Image;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbWFnZS5qcyJdLCJuYW1lcyI6WyJsb2FkZWQiLCJyZXF1aXJlIiwiTGlzdGVuZXJzIiwiSW1hZ2UiLCJzb3VyY2UiLCJ3aWR0aCIsImhlaWdodCIsImhhc0xvYWRlZCIsInNyYyIsImxpc3RlbmVycyIsImNyZWF0ZSIsImltZyIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsImVyciIsIm5vdGlmeSIsIm5hdHVyYWxXaWR0aCIsIm5hdHVyYWxIZWlnaHQiLCJiaW5kIiwicHJvdG90eXBlIiwiZ2V0QXNwZWN0UmF0aW8iLCJ0eXBlIiwiZGF0YSIsInNldFRpbWVvdXQiLCJvbiIsImZuIiwib2ZmIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxTQUFTQyxRQUFRLGtCQUFSLENBQWI7QUFDQSxJQUFJQyxZQUFZRCxRQUFRLGdCQUFSLENBQWhCOztBQUVBLElBQUlFLFFBQVEsU0FBUkEsS0FBUSxDQUFVQyxNQUFWLEVBQWtCO0FBQzVCLE9BQUtDLEtBQUwsR0FBYSxDQUFiO0FBQ0EsT0FBS0MsTUFBTCxHQUFjLENBQWQ7O0FBRUEsT0FBS0MsU0FBTCxHQUFpQixLQUFqQjtBQUNBLE9BQUtDLEdBQUwsR0FBVyxJQUFYOztBQUVBLE9BQUtDLFNBQUwsR0FBaUJQLFVBQVVRLE1BQVYsRUFBakI7O0FBRUEsTUFBSSxDQUFDTixNQUFMLEVBQWE7QUFDWDtBQUNEOztBQUVELE1BQUksT0FBT0EsTUFBUCxLQUFrQixRQUF0QixFQUFnQztBQUM5QixTQUFLSSxHQUFMLEdBQVdKLE1BQVg7QUFDQSxRQUFJTyxNQUFNQyxTQUFTQyxhQUFULENBQXVCLEtBQXZCLENBQVY7QUFDQUYsUUFBSUgsR0FBSixHQUFVLEtBQUtBLEdBQWY7QUFDQUosYUFBU08sR0FBVDtBQUNELEdBTEQsTUFLTztBQUNMLFNBQUtILEdBQUwsR0FBV0osT0FBT0ksR0FBbEI7QUFDRDs7QUFFRCxPQUFLSixNQUFMLEdBQWNBLE1BQWQ7O0FBRUFKLFNBQU9JLE1BQVAsRUFBZSxVQUFVVSxHQUFWLEVBQWU7QUFDNUIsUUFBSUEsR0FBSixFQUFTO0FBQ1AsV0FBS0MsTUFBTCxDQUFZLE9BQVosRUFBcUJELEdBQXJCO0FBQ0QsS0FGRCxNQUVPO0FBQ0wsV0FBS1AsU0FBTCxHQUFpQixJQUFqQjtBQUNBLFdBQUtGLEtBQUwsR0FBYUQsT0FBT1ksWUFBcEI7QUFDQSxXQUFLVixNQUFMLEdBQWNGLE9BQU9hLGFBQXJCO0FBQ0EsV0FBS0YsTUFBTCxDQUFZLE1BQVosRUFBb0IsSUFBcEI7QUFDRDtBQUNGLEdBVGMsQ0FTYkcsSUFUYSxDQVNSLElBVFEsQ0FBZjtBQVVELENBbENEOztBQW9DQWYsTUFBTU8sTUFBTixHQUFlLFVBQVVOLE1BQVYsRUFBa0I7QUFDL0IsU0FBTyxJQUFJRCxLQUFKLENBQVVDLE1BQVYsQ0FBUDtBQUNELENBRkQ7O0FBSUFELE1BQU1nQixTQUFOLENBQWdCQyxjQUFoQixHQUFpQyxZQUFZO0FBQzNDLE1BQUksQ0FBQyxLQUFLYixTQUFWLEVBQXFCO0FBQ25CLFdBQU8sQ0FBUDtBQUNEOztBQUVELFNBQU8sS0FBS0YsS0FBTCxHQUFhLEtBQUtDLE1BQXpCO0FBQ0QsQ0FORDs7QUFRQUgsTUFBTWdCLFNBQU4sQ0FBZ0JKLE1BQWhCLEdBQXlCLFVBQVVNLElBQVYsRUFBZ0JDLElBQWhCLEVBQXNCO0FBQzdDLE1BQUliLFlBQVksS0FBS0EsU0FBckI7QUFDQWMsYUFBVyxZQUFZO0FBQ3JCZCxjQUFVTSxNQUFWLENBQWlCTSxJQUFqQixFQUF1QkMsSUFBdkI7QUFDRCxHQUZELEVBRUcsQ0FGSDtBQUdELENBTEQ7O0FBT0FuQixNQUFNZ0IsU0FBTixDQUFnQkssRUFBaEIsR0FBcUIsVUFBVUgsSUFBVixFQUFnQkksRUFBaEIsRUFBb0I7QUFDdkMsT0FBS2hCLFNBQUwsQ0FBZWUsRUFBZixDQUFrQkgsSUFBbEIsRUFBd0JJLEVBQXhCO0FBQ0EsU0FBTyxJQUFQO0FBQ0QsQ0FIRDs7QUFLQXRCLE1BQU1nQixTQUFOLENBQWdCTyxHQUFoQixHQUFzQixVQUFVTCxJQUFWLEVBQWdCSSxFQUFoQixFQUFvQjtBQUN4QyxPQUFLaEIsU0FBTCxDQUFlaUIsR0FBZixDQUFtQkwsSUFBbkIsRUFBeUJJLEVBQXpCO0FBQ0EsU0FBTyxJQUFQO0FBQ0QsQ0FIRDs7QUFLQUUsT0FBT0MsT0FBUCxHQUFpQnpCLEtBQWpCIiwiZmlsZSI6IkltYWdlLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIGxvYWRlZCA9IHJlcXVpcmUoJy4vaW1hZ2VMb2FkZWQuanMnKVxudmFyIExpc3RlbmVycyA9IHJlcXVpcmUoJy4vTGlzdGVuZXJzLmpzJylcblxudmFyIEltYWdlID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICB0aGlzLndpZHRoID0gMFxuICB0aGlzLmhlaWdodCA9IDBcblxuICB0aGlzLmhhc0xvYWRlZCA9IGZhbHNlXG4gIHRoaXMuc3JjID0gbnVsbFxuXG4gIHRoaXMubGlzdGVuZXJzID0gTGlzdGVuZXJzLmNyZWF0ZSgpXG5cbiAgaWYgKCFzb3VyY2UpIHtcbiAgICByZXR1cm5cbiAgfVxuXG4gIGlmICh0eXBlb2Ygc291cmNlID09PSAnc3RyaW5nJykge1xuICAgIHRoaXMuc3JjID0gc291cmNlXG4gICAgdmFyIGltZyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2ltZycpXG4gICAgaW1nLnNyYyA9IHRoaXMuc3JjXG4gICAgc291cmNlID0gaW1nXG4gIH0gZWxzZSB7XG4gICAgdGhpcy5zcmMgPSBzb3VyY2Uuc3JjXG4gIH1cblxuICB0aGlzLnNvdXJjZSA9IHNvdXJjZVxuXG4gIGxvYWRlZChzb3VyY2UsIGZ1bmN0aW9uIChlcnIpIHtcbiAgICBpZiAoZXJyKSB7XG4gICAgICB0aGlzLm5vdGlmeSgnZXJyb3InLCBlcnIpXG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuaGFzTG9hZGVkID0gdHJ1ZVxuICAgICAgdGhpcy53aWR0aCA9IHNvdXJjZS5uYXR1cmFsV2lkdGhcbiAgICAgIHRoaXMuaGVpZ2h0ID0gc291cmNlLm5hdHVyYWxIZWlnaHRcbiAgICAgIHRoaXMubm90aWZ5KCdsb2FkJywgdGhpcylcbiAgICB9XG4gIH0uYmluZCh0aGlzKSlcbn1cblxuSW1hZ2UuY3JlYXRlID0gZnVuY3Rpb24gKHNvdXJjZSkge1xuICByZXR1cm4gbmV3IEltYWdlKHNvdXJjZSlcbn1cblxuSW1hZ2UucHJvdG90eXBlLmdldEFzcGVjdFJhdGlvID0gZnVuY3Rpb24gKCkge1xuICBpZiAoIXRoaXMuaGFzTG9hZGVkKSB7XG4gICAgcmV0dXJuIDFcbiAgfVxuXG4gIHJldHVybiB0aGlzLndpZHRoIC8gdGhpcy5oZWlnaHRcbn1cblxuSW1hZ2UucHJvdG90eXBlLm5vdGlmeSA9IGZ1bmN0aW9uICh0eXBlLCBkYXRhKSB7XG4gIHZhciBsaXN0ZW5lcnMgPSB0aGlzLmxpc3RlbmVyc1xuICBzZXRUaW1lb3V0KGZ1bmN0aW9uICgpIHtcbiAgICBsaXN0ZW5lcnMubm90aWZ5KHR5cGUsIGRhdGEpXG4gIH0sIDApXG59XG5cbkltYWdlLnByb3RvdHlwZS5vbiA9IGZ1bmN0aW9uICh0eXBlLCBmbikge1xuICB0aGlzLmxpc3RlbmVycy5vbih0eXBlLCBmbilcbiAgcmV0dXJuIHRoaXNcbn1cblxuSW1hZ2UucHJvdG90eXBlLm9mZiA9IGZ1bmN0aW9uICh0eXBlLCBmbikge1xuICB0aGlzLmxpc3RlbmVycy5vZmYodHlwZSwgZm4pXG4gIHJldHVybiB0aGlzXG59XG5cbm1vZHVsZS5leHBvcnRzID0gSW1hZ2VcbiJdfQ==