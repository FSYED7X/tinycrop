'use strict';

var Rectangle = require('./Rectangle.js');

var ImageLayer = function ImageLayer(opts) {
  opts = opts || {};
  this.bounds = Rectangle.create(0, 0, 0, 0);
  this.image = opts.image || null;
  this.parent = opts.parent;
  this.context = opts.context;
};

ImageLayer.create = function (opts) {
  return new ImageLayer(opts);
};

ImageLayer.prototype.setImage = function (image) {
  this.image = image;
};

ImageLayer.prototype.revalidate = function () {
  var parent = this.parent;
  var image = this.image;
  var bounds = this.bounds;

  if (image) {
    // Constrained by width (otherwise height)
    if (image.width / image.height >= parent.width / parent.height) {
      bounds.width = parent.width;
      bounds.height = Math.ceil(image.height / image.width * parent.width);
      bounds.x = 0;
      bounds.y = Math.floor((parent.height - bounds.height) * 0.5);
    } else {
      bounds.width = Math.ceil(image.width / image.height * parent.height);
      bounds.height = parent.height;
      bounds.x = Math.floor((parent.width - bounds.width) * 0.5);
      bounds.y = 0;
    }
  }
};

ImageLayer.prototype.paint = function () {
  var g = this.context;
  var image = this.image;
  var bounds = this.bounds;

  if (image && image.hasLoaded) {
    g.drawImage(image.source, 0, 0, image.width, image.height, bounds.x, bounds.y, bounds.width, bounds.height);
  }
};

module.exports = ImageLayer;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbIi4uL3NyYy9JbWFnZUxheWVyLmpzIl0sIm5hbWVzIjpbIlJlY3RhbmdsZSIsInJlcXVpcmUiLCJJbWFnZUxheWVyIiwib3B0cyIsImJvdW5kcyIsImNyZWF0ZSIsImltYWdlIiwicGFyZW50IiwiY29udGV4dCIsInByb3RvdHlwZSIsInNldEltYWdlIiwicmV2YWxpZGF0ZSIsIndpZHRoIiwiaGVpZ2h0IiwiTWF0aCIsImNlaWwiLCJ4IiwieSIsImZsb29yIiwicGFpbnQiLCJnIiwiaGFzTG9hZGVkIiwiZHJhd0ltYWdlIiwic291cmNlIiwibW9kdWxlIiwiZXhwb3J0cyJdLCJtYXBwaW5ncyI6Ijs7QUFBQSxJQUFJQSxZQUFZQyxRQUFRLGdCQUFSLENBQWhCOztBQUVBLElBQUlDLGFBQWEsU0FBYkEsVUFBYSxDQUFVQyxJQUFWLEVBQWdCO0FBQy9CQSxTQUFPQSxRQUFRLEVBQWY7QUFDQSxPQUFLQyxNQUFMLEdBQWNKLFVBQVVLLE1BQVYsQ0FBaUIsQ0FBakIsRUFBb0IsQ0FBcEIsRUFBdUIsQ0FBdkIsRUFBMEIsQ0FBMUIsQ0FBZDtBQUNBLE9BQUtDLEtBQUwsR0FBYUgsS0FBS0csS0FBTCxJQUFjLElBQTNCO0FBQ0EsT0FBS0MsTUFBTCxHQUFjSixLQUFLSSxNQUFuQjtBQUNBLE9BQUtDLE9BQUwsR0FBZUwsS0FBS0ssT0FBcEI7QUFDRCxDQU5EOztBQVFBTixXQUFXRyxNQUFYLEdBQW9CLFVBQVVGLElBQVYsRUFBZ0I7QUFDbEMsU0FBTyxJQUFJRCxVQUFKLENBQWVDLElBQWYsQ0FBUDtBQUNELENBRkQ7O0FBSUFELFdBQVdPLFNBQVgsQ0FBcUJDLFFBQXJCLEdBQWdDLFVBQVVKLEtBQVYsRUFBaUI7QUFDL0MsT0FBS0EsS0FBTCxHQUFhQSxLQUFiO0FBQ0QsQ0FGRDs7QUFJQUosV0FBV08sU0FBWCxDQUFxQkUsVUFBckIsR0FBa0MsWUFBWTtBQUM1QyxNQUFJSixTQUFTLEtBQUtBLE1BQWxCO0FBQ0EsTUFBSUQsUUFBUSxLQUFLQSxLQUFqQjtBQUNBLE1BQUlGLFNBQVMsS0FBS0EsTUFBbEI7O0FBRUEsTUFBSUUsS0FBSixFQUFXO0FBQ1Q7QUFDQSxRQUFJQSxNQUFNTSxLQUFOLEdBQWNOLE1BQU1PLE1BQXBCLElBQThCTixPQUFPSyxLQUFQLEdBQWVMLE9BQU9NLE1BQXhELEVBQWdFO0FBQzlEVCxhQUFPUSxLQUFQLEdBQWVMLE9BQU9LLEtBQXRCO0FBQ0FSLGFBQU9TLE1BQVAsR0FBZ0JDLEtBQUtDLElBQUwsQ0FBVVQsTUFBTU8sTUFBTixHQUFlUCxNQUFNTSxLQUFyQixHQUE2QkwsT0FBT0ssS0FBOUMsQ0FBaEI7QUFDQVIsYUFBT1ksQ0FBUCxHQUFXLENBQVg7QUFDQVosYUFBT2EsQ0FBUCxHQUFXSCxLQUFLSSxLQUFMLENBQVcsQ0FBQ1gsT0FBT00sTUFBUCxHQUFnQlQsT0FBT1MsTUFBeEIsSUFBa0MsR0FBN0MsQ0FBWDtBQUNELEtBTEQsTUFLTztBQUNMVCxhQUFPUSxLQUFQLEdBQWVFLEtBQUtDLElBQUwsQ0FBVVQsTUFBTU0sS0FBTixHQUFjTixNQUFNTyxNQUFwQixHQUE2Qk4sT0FBT00sTUFBOUMsQ0FBZjtBQUNBVCxhQUFPUyxNQUFQLEdBQWdCTixPQUFPTSxNQUF2QjtBQUNBVCxhQUFPWSxDQUFQLEdBQVdGLEtBQUtJLEtBQUwsQ0FBVyxDQUFDWCxPQUFPSyxLQUFQLEdBQWVSLE9BQU9RLEtBQXZCLElBQWdDLEdBQTNDLENBQVg7QUFDQVIsYUFBT2EsQ0FBUCxHQUFXLENBQVg7QUFDRDtBQUNGO0FBQ0YsQ0FuQkQ7O0FBcUJBZixXQUFXTyxTQUFYLENBQXFCVSxLQUFyQixHQUE2QixZQUFZO0FBQ3ZDLE1BQUlDLElBQUksS0FBS1osT0FBYjtBQUNBLE1BQUlGLFFBQVEsS0FBS0EsS0FBakI7QUFDQSxNQUFJRixTQUFTLEtBQUtBLE1BQWxCOztBQUVBLE1BQUlFLFNBQVNBLE1BQU1lLFNBQW5CLEVBQThCO0FBQzVCRCxNQUFFRSxTQUFGLENBQ0VoQixNQUFNaUIsTUFEUixFQUVFLENBRkYsRUFFSyxDQUZMLEVBRVFqQixNQUFNTSxLQUZkLEVBRXFCTixNQUFNTyxNQUYzQixFQUdFVCxPQUFPWSxDQUhULEVBR1laLE9BQU9hLENBSG5CLEVBR3NCYixPQUFPUSxLQUg3QixFQUdvQ1IsT0FBT1MsTUFIM0M7QUFLRDtBQUNGLENBWkQ7O0FBY0FXLE9BQU9DLE9BQVAsR0FBaUJ2QixVQUFqQiIsImZpbGUiOiJJbWFnZUxheWVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsidmFyIFJlY3RhbmdsZSA9IHJlcXVpcmUoJy4vUmVjdGFuZ2xlLmpzJylcblxudmFyIEltYWdlTGF5ZXIgPSBmdW5jdGlvbiAob3B0cykge1xuICBvcHRzID0gb3B0cyB8fCB7fVxuICB0aGlzLmJvdW5kcyA9IFJlY3RhbmdsZS5jcmVhdGUoMCwgMCwgMCwgMClcbiAgdGhpcy5pbWFnZSA9IG9wdHMuaW1hZ2UgfHwgbnVsbFxuICB0aGlzLnBhcmVudCA9IG9wdHMucGFyZW50XG4gIHRoaXMuY29udGV4dCA9IG9wdHMuY29udGV4dFxufVxuXG5JbWFnZUxheWVyLmNyZWF0ZSA9IGZ1bmN0aW9uIChvcHRzKSB7XG4gIHJldHVybiBuZXcgSW1hZ2VMYXllcihvcHRzKVxufVxuXG5JbWFnZUxheWVyLnByb3RvdHlwZS5zZXRJbWFnZSA9IGZ1bmN0aW9uIChpbWFnZSkge1xuICB0aGlzLmltYWdlID0gaW1hZ2Vcbn1cblxuSW1hZ2VMYXllci5wcm90b3R5cGUucmV2YWxpZGF0ZSA9IGZ1bmN0aW9uICgpIHtcbiAgdmFyIHBhcmVudCA9IHRoaXMucGFyZW50XG4gIHZhciBpbWFnZSA9IHRoaXMuaW1hZ2VcbiAgdmFyIGJvdW5kcyA9IHRoaXMuYm91bmRzXG5cbiAgaWYgKGltYWdlKSB7XG4gICAgLy8gQ29uc3RyYWluZWQgYnkgd2lkdGggKG90aGVyd2lzZSBoZWlnaHQpXG4gICAgaWYgKGltYWdlLndpZHRoIC8gaW1hZ2UuaGVpZ2h0ID49IHBhcmVudC53aWR0aCAvIHBhcmVudC5oZWlnaHQpIHtcbiAgICAgIGJvdW5kcy53aWR0aCA9IHBhcmVudC53aWR0aFxuICAgICAgYm91bmRzLmhlaWdodCA9IE1hdGguY2VpbChpbWFnZS5oZWlnaHQgLyBpbWFnZS53aWR0aCAqIHBhcmVudC53aWR0aClcbiAgICAgIGJvdW5kcy54ID0gMFxuICAgICAgYm91bmRzLnkgPSBNYXRoLmZsb29yKChwYXJlbnQuaGVpZ2h0IC0gYm91bmRzLmhlaWdodCkgKiAwLjUpXG4gICAgfSBlbHNlIHtcbiAgICAgIGJvdW5kcy53aWR0aCA9IE1hdGguY2VpbChpbWFnZS53aWR0aCAvIGltYWdlLmhlaWdodCAqIHBhcmVudC5oZWlnaHQpXG4gICAgICBib3VuZHMuaGVpZ2h0ID0gcGFyZW50LmhlaWdodFxuICAgICAgYm91bmRzLnggPSBNYXRoLmZsb29yKChwYXJlbnQud2lkdGggLSBib3VuZHMud2lkdGgpICogMC41KVxuICAgICAgYm91bmRzLnkgPSAwXG4gICAgfVxuICB9XG59XG5cbkltYWdlTGF5ZXIucHJvdG90eXBlLnBhaW50ID0gZnVuY3Rpb24gKCkge1xuICB2YXIgZyA9IHRoaXMuY29udGV4dFxuICB2YXIgaW1hZ2UgPSB0aGlzLmltYWdlXG4gIHZhciBib3VuZHMgPSB0aGlzLmJvdW5kc1xuXG4gIGlmIChpbWFnZSAmJiBpbWFnZS5oYXNMb2FkZWQpIHtcbiAgICBnLmRyYXdJbWFnZShcbiAgICAgIGltYWdlLnNvdXJjZSxcbiAgICAgIDAsIDAsIGltYWdlLndpZHRoLCBpbWFnZS5oZWlnaHQsXG4gICAgICBib3VuZHMueCwgYm91bmRzLnksIGJvdW5kcy53aWR0aCwgYm91bmRzLmhlaWdodFxuICAgIClcbiAgfVxufVxuXG5tb2R1bGUuZXhwb3J0cyA9IEltYWdlTGF5ZXJcbiJdfQ==