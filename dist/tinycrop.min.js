!function(t,i){"object"==typeof exports&&"object"==typeof module?module.exports=i():"function"==typeof define&&define.amd?define([],i):"object"==typeof exports?exports.tinycrop=i():t.tinycrop=i()}(this,function(){return function(t){function i(n){if(e[n])return e[n].exports;var o=e[n]={exports:{},id:n,loaded:!1};return t[n].call(o.exports,o,o.exports,i),o.loaded=!0,o.exports}var e={};return i.m=t,i.c=e,i.p="",i(0)}([function(t,i,e){"use strict";function n(){}function o(t){return"string"==typeof t&&(t.length>=1&&("%"===t[t.length-1]||void 0))}function s(t){return o(t)?t.slice(0,-1):0}function h(t){return"auto"===t}function r(t){return"number"==typeof t&&Math.round(t)===t}var a=e(9),u=e(3),c=e(5),d=e(8),l=e(4),f=e(1),g=400,p=300,y=function(t){this.parent="string"==typeof t.parent?document.querySelector(t.parent):t.parent,this.canvas=document.createElement("canvas"),this.context=this.canvas.getContext("2d"),this.boundsOpts=t.bounds||{width:"100%",height:"auto"},t.selection=t.selection||{},this.debounceResize=void 0===t.debounceResize||t.debounceResize,this.listeners=f.create(),this.parent.appendChild(this.canvas),this.backgroundLayer=u.create({parent:this,context:this.context,colors:t.backgroundColors||["#fff","#f0f0f0"]}),this.imageLayer=c.create({parent:this,context:this.context,image:this.image}),this.selectionLayer=d.create({parent:this,context:this.context,target:this.imageLayer,aspectRatio:t.selection.aspectRatio,minWidth:t.selection.minWidth,minHeight:t.selection.minHeight,x:t.selection.x,y:t.selection.y,width:t.selection.width,height:t.selection.height,handle:{color:t.selection.color,activeColor:t.selection.activeColor}});var i=this.listeners,e=this.paint.bind(this);this.selectionLayer.on("start",function(t){e(),i.notify("start",t)}).on("move",function(t){i.notify("move",t)}).on("resize",function(t){i.notify("resize",t)}).on("change",function(t){e(),i.notify("change",t)}).on("end",function(t){e(),i.notify("end",t)}),window.addEventListener("resize",this.debounceResize?a(this.revalidateAndPaint.bind(this),100):this.revalidateAndPaint.bind(this)),this.setImage(t.image),this.revalidateAndPaint()};y.create=function(t){return new y(t)},y.prototype.on=function(t,i){return this.listeners.on(t,i),this},y.prototype.off=function(t,i){return this.listeners.off(t,i),this},y.prototype.revalidateAndPaint=function(){this.revalidate(),this.paint()},y.prototype.revalidate=function(){var t=this.parent,i=this.image,e=this.boundsOpts.width,n=this.boundsOpts.height,a=0,u=0;a=r(e)?e:t&&o(e)?Math.round(t.clientWidth*s(e)/100):g,u=r(n)?n:o(n)?Math.round(a*s(n)/100):i&&i.hasLoaded&&h(n)?Math.floor(a/i.getAspectRatio()):p,this.resizeCanvas(a,u),this.backgroundLayer.revalidate(),this.imageLayer.revalidate(),this.selectionLayer.revalidate()},y.prototype.paint=function(){var t=this.context;t.save(),t.scale(this.ratio,this.ratio),this.backgroundLayer.paint(),this.image&&this.image.hasLoaded&&(this.imageLayer.paint(),this.selectionLayer.paint()),t.restore()},y.prototype.resizeCanvas=function(t,i){var e=this.context,n=this.canvas;this.ratio=1,e.webkitBackingStorePixelRatio||(this.ratio=window.devicePixelRatio||1),this.width=t,this.height=i,n.width=this.width*this.ratio,n.height=this.height*this.ratio},y.prototype.setImage=function(t){var i=l.create(t).on("load",function(){this.selectionLayer.onImageLoad(),this.revalidateAndPaint()}.bind(this)).on("error",function(t){console.error(t)});this.imageLayer.setImage(i),this.image=i,this.revalidateAndPaint()},y.prototype.getImage=function(){return this.image},y.prototype.setAspectRatio=function(t){this.selectionLayer.setAspectRatio(t),this.revalidateAndPaint()},y.prototype.setBounds=function(t){this.boundsOpts=t,this.revalidateAndPaint()},y.prototype.setBackgroundColors=function(t){this.backgroundLayer.setColors(t),this.revalidateAndPaint()},y.prototype.dispose=n,t.exports=y},function(t,i){"use strict";var e=function(t){this.events={}};e.create=function(t){return new e(t)},e.prototype.on=function(t,i){return this.events[t]||(this.events[t]=[]),this.events[t].indexOf(i)===-1&&this.events[t].push(i),this},e.prototype.off=function(t,i){if(this.events[t]){var e=this.events[t].indexOf(i);e!==-1&&this.events[t].splice(e,1)}return this},e.prototype.notify=function(t,i){this.events[t]&&this.events[t].forEach(function(t){t.call(this,i)}.bind(this))},e.prototype.clearAll=function(){this.events={}},t.exports=e},function(t,i){"use strict";var e=function(t,i,e,n){this._x=t,this._y=i,this._width=e,this._height=n};e.prototype.copy=function(t){return this._x=t.x,this._y=t.y,this._width=t.width,this._height=t.height,this},e.prototype.clone=function(){return e.create(this._x,this._y,this._width,this._height)},e.prototype.round=function(){var t=this._x,i=this._y;return this._x=Math.round(t),this._y=Math.round(i),t-=this._x,i-=this._y,this._width=Math.round(this._width+t),this._height=Math.round(this._height+i),this},e.prototype.isInside=function(t){return t.x>=this.left&&t.y>=this.top&&this.right>t.x&&this.bottom>t.y},Object.defineProperties(e.prototype,{x:{get:function(){return this._x},set:function(t){this._x=t}},y:{get:function(){return this._y},set:function(t){this._y=t}},centerX:{get:function(){return this._x+.5*this._width},set:function(t){this._x=t-.5*this._width}},centerY:{get:function(){return this._y+.5*this._height},set:function(t){this._y=t-.5*this._height}},width:{get:function(){return this._width},set:function(t){this._width=t}},height:{get:function(){return this._height},set:function(t){this._height=t}},left:{get:function(){return this._x},set:function(t){this._width=this._x+this._width-t,this._x=t}},top:{get:function(){return this._y},set:function(t){this._height=this._y+this._height-t,this._y=t}},right:{get:function(){return this._x+this._width},set:function(t){this._width=t-this._x}},bottom:{get:function(){return this._y+this._height},set:function(t){this._height=t-this._y}},aspectRatio:{get:function(){return this._width/this._height}}}),e.create=function(t,i,n,o){return new e(t,i,n,o)},t.exports=e},function(t,i){"use strict";var e=function(t){t=t||{},this.colors=t.colors,this.parent=t.parent,this.context=t.context,this.isDirty=!0};e.create=function(t){return new e(t)},e.prototype.revalidate=function(){this.isDirty=!0},e.prototype.setColors=function(t){this.colors=t},e.prototype.paint=function(){if(this.isDirty){var t=this.parent,i=this.context;if(this.colors&&this.colors.length?(i.fillStyle=this.colors[0],i.fillRect(0,0,t.width,t.height)):i.clearRect(0,0,t.width,t.height),this.colors&&this.colors.length>1){var e=t.height,n=32,o=t.width/n,s=Math.ceil(e/o);i.fillStyle=this.colors[1];for(var h=0;n>h;h+=1)for(var r=0;s>r;r+=1)(h+r)%2===0&&i.fillRect(h*o,r*o,o,o)}this.isDirty=!1}},t.exports=e},function(t,i,e){"use strict";var n=e(10),o=e(1),s=function(t){if(this.width=0,this.height=0,this.hasLoaded=!1,this.src=null,this.listeners=o.create(),t){if("string"==typeof t){this.src=t;var i=document.createElement("img");i.src=this.src,t=i}else this.src=t.src;this.source=t,n(t,function(i){i?this.notify("error",i):(this.hasLoaded=!0,this.width=t.naturalWidth,this.height=t.naturalHeight,this.notify("load",this))}.bind(this))}};s.create=function(t){return new s(t)},s.prototype.getAspectRatio=function(){return this.hasLoaded?this.width/this.height:1},s.prototype.notify=function(t,i){var e=this.listeners;setTimeout(function(){e.notify(t,i)},0)},s.prototype.on=function(t,i){return this.listeners.on(t,i),this},s.prototype.off=function(t,i){return this.listeners.off(t,i),this},t.exports=s},function(t,i,e){"use strict";var n=e(2),o=function(t){t=t||{},this.bounds=n.create(0,0,0,0),this.image=t.image||null,this.parent=t.parent,this.context=t.context};o.create=function(t){return new o(t)},o.prototype.setImage=function(t){this.image=t},o.prototype.revalidate=function(){var t=this.parent,i=this.image,e=this.bounds;i&&(t.width/t.height>i.width/i.height?(e.width=Math.ceil(i.width/i.height*t.height),e.height=t.height,e.x=Math.floor(.5*(t.width-e.width)),e.y=0):(e.width=t.width,e.height=Math.ceil(i.height/i.width*t.width),e.x=0,e.y=Math.floor(.5*(t.height-e.height))))},o.prototype.paint=function(){var t=this.context,i=this.image,e=this.bounds;i&&i.hasLoaded&&t.drawImage(i.source,0,0,i.width,i.height,e.x,e.y,e.width,e.height)},t.exports=o},function(t,i,e){"use strict";var n=e(1),o=function(t){function i(t){var i=t.offsetX,e=t.offsetY;return{source:t,x:i,y:e,dx:s?i-s.x:0,dy:s?e-s.y:0,type:"Mouse"}}function e(t){var i=t.target.getBoundingClientRect(),e=t.touches.length>0?t.touches[0]:t.changedTouches[0],n=e.clientX-i.left,o=e.clientY-i.top;return{source:t,x:n,y:o,dx:s?n-s.x:0,dy:s?o-s.y:0,type:"Touch"}}var o=n.create(),s=null;this.listeners=o,t.addEventListener("mousedown",function(t){s=i(t),o.notify("down",s)}),t.addEventListener("touchstart",function(t){s=e(t),o.notify("down",s)}),t.addEventListener("mousemove",function(t){o.notify("move",i(t))}),t.addEventListener("touchmove",function(t){o.notify("move",e(t))}),t.addEventListener("mouseup",function(t){o.notify("up",i(t))}),t.addEventListener("touchend",function(t){o.notify("up",e(t)),s=null}),t.addEventListener("mouseout",function(t){o.notify("cancel",i(t)),s=null}),t.addEventListener("touchcancel",function(t){o.notify("cancel",e(t)),s=null})};o.create=function(t){return new o(t)},o.prototype.on=function(t,i){return this.listeners.on(t,i),this},o.prototype.off=function(t,i){return this.listeners.off(t,i),this},t.exports=o},function(t,i,e){"use strict";var n=e(2),o=function(t){this.target=t.target||null,this.bounds=n.create(0,0,0,0),this.boundsPx=n.create(0,0,0,0),this.region=n.create(0,0,0,0),this.initialOpts={x:t.x,y:t.y,width:t.width,height:t.height},this.aspectRatio=t.aspectRatio,this.minWidth=void 0!==t.minWidth?t.minWidth:100,this.minHeight=void 0!==t.minHeight?t.minHeight:100,this.boundsMinWidth=0,this.boundsMinHeight=0,this._delta={x:0,h:0}};Object.defineProperties(o.prototype,{x:{get:function(){return this.bounds.x},set:function(t){this.bounds.x=t}},y:{get:function(){return this.bounds.y},set:function(t){this.bounds.y=t}},width:{get:function(){return this.bounds.width},set:function(t){this.bounds.width=t}},height:{get:function(){return this.bounds.height},set:function(t){this.bounds.height=t}},left:{get:function(){return this.bounds.x},set:function(t){this.bounds.left=t}},top:{get:function(){return this.bounds.y},set:function(t){this.bounds.top=t}},right:{get:function(){return this.bounds.right},set:function(t){this.bounds.right=t}},bottom:{get:function(){return this.bounds.bottom},set:function(t){this.bounds.bottom=t}}}),o.prototype.getBoundsLengthForRegion=function(t){return t/this.region.width*this.width},o.prototype.moveBy=function(t,i){var e=this.bounds,n=this.target;return e.x=Math.min(Math.max(e.x+t,n.bounds.x),n.bounds.x+n.bounds.width-e.width),e.y=Math.min(Math.max(e.y+i,n.bounds.y),n.bounds.y+n.bounds.height-e.height),this.updateRegionFromBounds()},o.prototype.resizeBy=function(t,i,e){function n(t,i){return o.width=h.width+t,o.height=h.height+i,o.width=Math.max(r,o.width),o.height=Math.max(a,o.height),s&&(o.width/o.height>s?o.width=o.height*s:o.height=o.width/s),o.width-=h.width,o.height-=h.height,o}var o=this._delta,s=this.aspectRatio,h=this.bounds,r=this.boundsMinWidth,a=this.boundsMinHeight,u=this.target;switch("n"===e[0]?i=Math.min(i,this.top-u.bounds.top):"s"===e[0]&&(i=Math.min(i,u.bounds.bottom-this.bottom)),"w"===e[1]?t=Math.min(t,this.left-u.bounds.left):"e"===e[1]&&(t=Math.min(t,u.bounds.right-this.right)),o=n(t,i),e){case"nw":this.left-=o.width,this.top-=o.height;break;case"ne":this.right+=o.width,this.top-=o.height;break;case"sw":this.left-=o.width,this.bottom+=o.height;break;case"se":this.right+=o.width,this.bottom+=o.height}return this.updateRegionFromBounds()},o.prototype.autoSizeRegion=function(){var t=this.target,i=this.region,e=this.aspectRatio,n=this.initialOpts,o=i.x,s=i.y,h=i.width,r=i.height;return i.x=void 0!==n.x?n.x:0,i.y=void 0!==n.y?n.y:0,i.width=void 0!==n.width?n.width:t.image.width,i.height=void 0!==n.height?n.height:t.image.height,e&&(i.width/i.height>e?i.width=i.height*e:i.height=i.width/e),void 0===n.x&&(i.centerX=.5*t.image.width),void 0===n.y&&(i.centerY=.5*t.image.height),i.round(),this.updateBoundsFromRegion(),i.x!==o||i.y!==s||i.width!==h||i.height!==r},o.prototype.updateRegionFromBounds=function(){var t=this.target,i=this.region,e=this.bounds,n=i.x,o=i.y,s=i.width,h=i.height;return i.x=t.image.width*(e.x-t.bounds.x)/t.bounds.width,i.y=t.image.height*(e.y-t.bounds.y)/t.bounds.height,i.width=t.image.width*(e.width/t.bounds.width),i.height=t.image.height*(e.height/t.bounds.height),i.round(),i.x!==n||i.y!==o||i.width!==s||i.height!==h},o.prototype.updateBoundsFromRegion=function(){var t=this.target,i=this.region,e=this.bounds;t.image&&(e.x=t.bounds.x+t.bounds.width*(i.x/t.image.width),e.y=t.bounds.y+t.bounds.height*(i.y/t.image.height),e.width=t.bounds.width*(i.width/t.image.width),e.height=t.bounds.height*(i.height/t.image.height)),this.boundsMinWidth=this.getBoundsLengthForRegion(this.minWidth),this.boundsMinHeight=this.getBoundsLengthForRegion(this.minHeight)},o.prototype.isInside=function(t){return this.bounds.isInside(t)},o.create=function(t){return new o(t)},t.exports=o},function(t,i,e){"use strict";var n=e(6),o=e(1),s=e(7),h=e(2),r=function(t){t=t||{},this.selection=s.create(t),this.parent=t.parent,this.context=t.context,this.context.setLineDash=this.context.setLineDash||function(){},this.target=t.target;var i=t.handle||{};i.length=i.handleLength||32,i.depth=i.depth||3,i.size=i.size||2*i.length,i.color=i.color||"rgba(255, 255, 255, 1.0)",i.activeColor=i.activeColor||"rgba(255, 0, 160, 1.0)",this.handleOpts=i,this.listeners=o.create(),this.input=n.create(this.parent.canvas),this.activeRegion=null,this.downBounds=h.create(0,0,0,0),this.input.on("down",this.onInputDown.bind(this)),this.input.on("move",this.onInputMove.bind(this)),this.input.on("up",this.onInputUpOrCancel.bind(this)).on("cancel",this.onInputUpOrCancel.bind(this))};r.create=function(t){return new r(t)},r.prototype.onInputDown=function(t){var i=this.findHitRegion(t);i&&(t.source.preventDefault(),this.activeRegion=i,this.setCursor(i),this.downBounds.copy(this.selection.bounds),this.listeners.notify("start",this.selection.region))},r.prototype.onInputMove=function(t){var i=this.activeRegion;if(i){t.source.preventDefault();var e=this.selection,n=!1;if(e.bounds.copy(this.downBounds),"move"===i)n=e.moveBy(t.dx,t.dy),n&&this.listeners.notify("move",this.selection.region);else{var o=i.substring(0,2),s="w"===o[1]?-t.dx:t.dx,h="n"===o[0]?-t.dy:t.dy;n=e.resizeBy(s,h,o),n&&this.listeners.notify("resize",this.selection.region)}n&&this.listeners.notify("change",this.selection.region)}else{var r=this.findHitRegion(t);r?(t.source.preventDefault(),this.setCursor(r)):this.resetCursor()}},r.prototype.onInputUpOrCancel=function(t){t.source.preventDefault(),this.activeRegion&&(this.activeRegion=null,this.resetCursor(),this.listeners.notify("end",this.selection.region))},r.prototype.findHitRegion=function(t){var i=null,e=Number.MAX_VALUE,n=this.isWithinNorthWestHandle(t);return n!==!1&&e>n&&(e=n,i="nw-resize"),n=this.isWithinNorthEastHandle(t),n!==!1&&e>n&&(e=n,i="ne-resize"),n=this.isWithinSouthWestHandle(t),n!==!1&&e>n&&(e=n,i="sw-resize"),n=this.isWithinSouthEastHandle(t),n!==!1&&e>n&&(e=n,i="se-resize"),i?i:this.isWithinBounds(t)?"move":null},r.prototype.on=function(t,i){return this.listeners.on(t,i),this},r.prototype.off=function(t,i){return this.listeners.off(t,i),this},r.prototype.setCursor=function(t){this.parent.canvas.style.cursor!==t&&(this.parent.canvas.style.cursor=t)},r.prototype.resetCursor=function(){this.setCursor("auto")},r.prototype.isWithinRadius=function(t,i,e,n,o){var s=o*o,h=t-e,r=i-n,a=h*h+r*r;return s>a&&a},r.prototype.isWithinNorthWestHandle=function(t){return this.isWithinRadius(t.x,t.y,this.selection.left,this.selection.top,this.getHandleRadius())},r.prototype.isWithinNorthEastHandle=function(t){return this.isWithinRadius(t.x,t.y,this.selection.right,this.selection.top,this.getHandleRadius())},r.prototype.isWithinSouthWestHandle=function(t){return this.isWithinRadius(t.x,t.y,this.selection.left,this.selection.bottom,this.getHandleRadius())},r.prototype.isWithinSouthEastHandle=function(t){return this.isWithinRadius(t.x,t.y,this.selection.right,this.selection.bottom,this.getHandleRadius())},r.prototype.isWithinBounds=function(t){return this.selection.isInside(t)},r.prototype.getHandleRadius=function(){return this.handleOpts.size/2},r.prototype.onImageLoad=function(){this.autoSizeRegionAndNotify()},r.prototype.setAspectRatio=function(t){this.selection.aspectRatio=t,this.autoSizeRegionAndNotify()},r.prototype.autoSizeRegionAndNotify=function(){var t=this.selection.autoSizeRegion();t&&this.listeners.notify("change",this.selection.region)},r.prototype.revalidate=function(){this.selection.updateBoundsFromRegion()},r.prototype.paint=function(){this.selection.boundsPx.copy(this.selection.bounds).round(),this.paintOutside(),this.paintInside()},r.prototype.paintOutside=function(){var t=this.selection.boundsPx,i=this.context,e=this.target,n=e.bounds.x,o=e.bounds.y,s=e.bounds.width,h=e.bounds.right,r=e.bounds.bottom,a=t.x,u=t.y,c=t.height,d=t.right,l=t.bottom;i.fillStyle="rgba(0, 0, 0, 0.5)",i.fillRect(n,o,s,u-o),i.fillRect(n,u,a-n,c),i.fillRect(d,u,h-d,c),i.fillRect(n,l,s,r-l)},r.prototype.paintInside=function(){var t=this.context,i=this.selection.boundsPx,e=this.activeRegion,n=this.handleOpts,o=Math.min(n.length,.5*i.width),s=Math.min(n.length,.5*i.height),h=n.depth,r=n.color,a=n.activeColor,u=0;t.fillStyle="rgba(255, 255, 255, 0.3)",t.fillRect(i.x+u,i.y,i.width-2*u,h),t.fillRect(i.x+u,i.bottom-h,i.width-2*u,h),t.fillRect(i.x,i.y+u,h,i.height-2*u),t.fillRect(i.right-h,i.y+u,h,i.height-2*u);var c="move"===e;t.fillStyle=c||"nw-resize"===e?a:r,t.fillRect(i.x,i.y,o,h),t.fillRect(i.x,i.y+h,h,s-h),t.fillStyle=c||"ne-resize"===e?a:r,t.fillRect(i.right-o,i.y,o,h),t.fillRect(i.right-h,i.y+h,h,s-h),t.fillStyle=c||"sw-resize"===e?a:r,t.fillRect(i.x,i.bottom-h,o,h),t.fillRect(i.x,i.bottom-s,h,s-h),t.fillStyle=c||"se-resize"===e?a:r,t.fillRect(i.right-o,i.bottom-h,o,h),t.fillRect(i.right-h,i.bottom-s,h,s-h),t.strokeStyle="rgba(255, 255, 255, 0.6)",t.setLineDash([2,3]),t.lineWidth=1,t.beginPath();var d=i.width/3,l=i.height/3;t.moveTo(i.x+d,i.y),t.lineTo(i.x+d,i.y+i.height),t.moveTo(i.x+2*d,i.y),t.lineTo(i.x+2*d,i.y+i.height),t.moveTo(i.x,i.y+l),t.lineTo(i.x+i.width,i.y+l),t.moveTo(i.x,i.y+2*l),t.lineTo(i.x+i.width,i.y+2*l),t.stroke(),t.closePath()},t.exports=r},function(t,i){"use strict";function e(t,i,e){var n;return function(){var o=this,s=arguments;clearTimeout(n),n=setTimeout(function(){n=null,e||t.apply(o,s)},i),e&&!n&&t.apply(o,s)}}t.exports=e},function(t,i){"use strict";function e(t,i){if(!t.nodeName||"img"!==t.nodeName.toLowerCase())return i(Error("First argument must an image element"));if(t.src&&t.complete&&void 0!==t.naturalWidth)return i(null,!0);if(t.addEventListener("load",function(){i(null,!1)}),t.addEventListener("error",function(e){i(Error("Failed to load image '"+(t.src||"")+"'"))}),t.complete){var e=t.src;t.src=n,t.src=e}}var n="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///ywAAAAAAQABAAACAUwAOw==";t.exports=e}])});